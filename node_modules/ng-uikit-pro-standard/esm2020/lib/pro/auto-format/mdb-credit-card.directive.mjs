import { Directive, HostListener, Input, HostBinding } from '@angular/core';
import * as i0 from "@angular/core";
export class MdbCreditCardDirective {
    constructor() {
        this.standardPattern = /(\d{1,4})/g;
        this.defaultCard = {
            name: '',
            fullName: '',
            re: /\d{0,16}/,
            pattern: this.standardPattern,
            maxLength: 19,
            cvvLength: 3,
        };
        this.cards = [
            {
                name: 'visa',
                fullName: 'Visa',
                re: /^4\d{0,15}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'mastercard',
                fullName: 'Mastercard',
                re: /^(5[1-5]\d{0,2}|22[2-9]\d{0,1}|2[3-7]\d{0,2})\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'amex',
                fullName: 'American Express',
                re: /^3[47]\d{0,13}/,
                pattern: /(\d{1,4})(\d{1,6})?(\d{1,5})?/,
                maxLength: 15,
                cvvLength: 4,
            },
            {
                name: 'jcb',
                fullName: 'JCB',
                re: /^(?:35\d{0,2})\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'discover',
                fullName: 'Discover',
                re: /^(?:6011|65\d{0,2}|64[4-9]\d?)\d{0,12}/,
                pattern: this.standardPattern,
                maxLength: 16,
                cvvLength: 3,
            },
            {
                name: 'diners-club',
                fullName: 'Diners Club',
                re: /^3(?:0([0-5]|9)|[689]\d?)\d{0,11}/,
                pattern: this.standardPattern,
                maxLength: 14,
                cvvLength: 3,
            },
        ];
        this._separator = ' ';
    }
    get additionalCards() {
        return this._additionalCards;
    }
    set additionalCards(cards) {
        this._additionalCards = cards;
        this.addCards(cards);
    }
    get separator() {
        return this._separator;
    }
    set separator(separator) {
        this._separator = separator;
    }
    onInput(event) {
        this.formatInput(event);
    }
    formatInput(event) {
        const input = event.target.value;
        const formattedInput = this.getFormattedInput(input);
        event.target.value = formattedInput;
    }
    getFormattedInput(value) {
        value = this.removeNonDigits(value);
        const card = this.findCardByNumber(value);
        this.updateCurrentCardNames(card.name, card.fullName);
        let cardNumMaxLength;
        if (this.hasStandardPattern(card)) {
            const matches = value.match(card.pattern);
            if (matches === null) {
                return value;
            }
            cardNumMaxLength = card.maxLength + matches.length - 1;
            this.maxLength = cardNumMaxLength.toString();
            return matches.join(this.separator);
        }
        else {
            const results = card.pattern.exec(value);
            if (results === null) {
                return value;
            }
            results.shift();
            cardNumMaxLength = card.maxLength + results.length - 1;
            this.maxLength = cardNumMaxLength.toString();
            return results.filter(this.isMatch).join(this.separator);
        }
    }
    removeNonDigits(value) {
        return value.replace(/\D/g, '');
    }
    hasStandardPattern(card) {
        return card.pattern.toString() === this.standardPattern.toString();
    }
    isMatch(match) {
        return match !== undefined;
    }
    updateCurrentCardNames(name, fullName) {
        this.cardName = name;
        this.cardFullName = fullName;
    }
    findCardByNumber(value) {
        const cardType = this.cards.find(card => {
            return card.re.test(value);
        });
        if (!cardType) {
            return this.defaultCard;
        }
        return cardType;
    }
    addCards(newCards) {
        newCards.forEach(card => {
            this.cards.push(card);
        });
    }
}
MdbCreditCardDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.7", ngImport: i0, type: MdbCreditCardDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive });
MdbCreditCardDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.2.7", type: MdbCreditCardDirective, selector: "[mdbCreditCard]", inputs: { additionalCards: "additionalCards", separator: "separator" }, host: { listeners: { "input": "onInput($event)" }, properties: { "attr.maxLength": "this.maxLength" } }, exportAs: ["mdbCreditCard"], ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.7", ngImport: i0, type: MdbCreditCardDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[mdbCreditCard]',
                    exportAs: 'mdbCreditCard',
                }]
        }], ctorParameters: function () { return []; }, propDecorators: { additionalCards: [{
                type: Input
            }], separator: [{
                type: Input
            }], maxLength: [{
                type: HostBinding,
                args: ['attr.maxLength']
            }], onInput: [{
                type: HostListener,
                args: ['input', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRiLWNyZWRpdC1jYXJkLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLXVpa2l0LXByby1zdGFuZGFyZC9zcmMvbGliL3Byby9hdXRvLWZvcm1hdC9tZGItY3JlZGl0LWNhcmQuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxlQUFlLENBQUM7O0FBZTVFLE1BQU0sT0FBTyxzQkFBc0I7SUFvRmpDO1FBbkZRLG9CQUFlLEdBQUcsWUFBWSxDQUFDO1FBSS9CLGdCQUFXLEdBQWU7WUFDaEMsSUFBSSxFQUFFLEVBQUU7WUFDUixRQUFRLEVBQUUsRUFBRTtZQUNaLEVBQUUsRUFBRSxVQUFVO1lBQ2QsT0FBTyxFQUFFLElBQUksQ0FBQyxlQUFlO1lBQzdCLFNBQVMsRUFBRSxFQUFFO1lBQ2IsU0FBUyxFQUFFLENBQUM7U0FDYixDQUFDO1FBRU0sVUFBSyxHQUFpQjtZQUM1QjtnQkFDRSxJQUFJLEVBQUUsTUFBTTtnQkFDWixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsRUFBRSxFQUFFLFlBQVk7Z0JBQ2hCLE9BQU8sRUFBRSxJQUFJLENBQUMsZUFBZTtnQkFDN0IsU0FBUyxFQUFFLEVBQUU7Z0JBQ2IsU0FBUyxFQUFFLENBQUM7YUFDYjtZQUNEO2dCQUNFLElBQUksRUFBRSxZQUFZO2dCQUNsQixRQUFRLEVBQUUsWUFBWTtnQkFDdEIsRUFBRSxFQUFFLHVEQUF1RDtnQkFDM0QsT0FBTyxFQUFFLElBQUksQ0FBQyxlQUFlO2dCQUM3QixTQUFTLEVBQUUsRUFBRTtnQkFDYixTQUFTLEVBQUUsQ0FBQzthQUNiO1lBQ0Q7Z0JBQ0UsSUFBSSxFQUFFLE1BQU07Z0JBQ1osUUFBUSxFQUFFLGtCQUFrQjtnQkFDNUIsRUFBRSxFQUFFLGdCQUFnQjtnQkFDcEIsT0FBTyxFQUFF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T0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVNLFFBQVEsQ0FBQyxRQUFzQjtRQUNwQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3RCLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7bUhBbktVLHNCQUFzQjt1R0FBdEIsc0JBQXNCOzJGQUF0QixzQkFBc0I7a0JBSmxDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLGlCQUFpQjtvQkFDM0IsUUFBUSxFQUFFLGVBQWU7aUJBQzFCOzBFQW1FSyxlQUFlO3NCQURsQixLQUFLO2dCQVdGLFNBQVM7c0JBRFosS0FBSztnQkFXeUIsU0FBUztzQkFBdkMsV0FBVzt1QkFBQyxnQkFBZ0I7Z0JBRzdCLE9BQU87c0JBRE4sWUFBWTt1QkFBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEhvc3RMaXN0ZW5lciwgSW5wdXQsIEhvc3RCaW5kaW5nIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlZGl0Q2FyZCB7XG4gIG5hbWU6IHN0cmluZztcbiAgZnVsbE5hbWU6IHN0cmluZztcbiAgcmU6IFJlZ0V4cDtcbiAgcGF0dGVybjogUmVnRXhwO1xuICBtYXhMZW5ndGg6IG51bWJlcjtcbiAgY3Z2TGVuZ3RoOiBudW1iZXI7XG59XG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1ttZGJDcmVkaXRDYXJkXScsXG4gIGV4cG9ydEFzOiAnbWRiQ3JlZGl0Q2FyZCcsXG59KVxuZXhwb3J0IGNsYXNzIE1kYkNyZWRpdENhcmREaXJlY3RpdmUge1xuICBwcml2YXRlIHN0YW5kYXJkUGF0dGVybiA9IC8oXFxkezEsNH0pL2c7XG4gIGNhcmROYW1lOiBzdHJpbmc7XG4gIGNhcmRGdWxsTmFtZTogc3RyaW5nO1xuXG4gIHByaXZhdGUgZGVmYXVsdENhcmQ6IENyZWRpdENhcmQgPSB7XG4gICAgbmFtZTogJycsXG4gICAgZnVsbE5hbWU6ICcnLFxuICAgIHJlOiAvXFxkezAsMTZ9LyxcbiAgICBwYXR0ZXJuOiB0aGlzLnN0YW5kYXJkUGF0dGVybixcbiAgICBtYXhMZW5ndGg6IDE5LFxuICAgIGN2dkxlbmd0aDogMyxcbiAgfTtcblxuICBwcml2YXRlIGNhcmRzOiBDcmVkaXRDYXJkW10gPSBbXG4gICAge1xuICAgICAgbmFtZTogJ3Zpc2EnLFxuICAgICAgZnVsbE5hbWU6ICdWaXNhJyxcbiAgICAgIHJlOiAvXjRcXGR7MCwxNX0vLFxuICAgICAgcGF0dGVybjogdGhpcy5zdGFuZGFyZFBhdHRlcm4sXG4gICAgICBtYXhMZW5ndGg6IDE2LFxuICAgICAgY3Z2TGVuZ3RoOiAzLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ21hc3RlcmNhcmQnLFxuICAgICAgZnVsbE5hbWU6ICdNYXN0ZXJjYXJkJyxcbiAgICAgIHJlOiAvXig1WzEtNV1cXGR7MCwyfXwyMlsyLTldXFxkezAsMX18MlszLTddXFxkezAsMn0pXFxkezAsMTJ9LyxcbiAgICAgIHBhdHRlcm46IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLFxuICAgICAgbWF4TGVuZ3RoOiAxNixcbiAgICAgIGN2dkxlbmd0aDogMyxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdhbWV4JyxcbiAgICAgIGZ1bGxOYW1lOiAnQW1lcmljYW4gRXhwcmVzcycsXG4gICAgICByZTogL14zWzQ3XVxcZHswLDEzfS8sXG4gICAgICBwYXR0ZXJuOiAvKFxcZHsxLDR9KShcXGR7MSw2fSk/KFxcZHsxLDV9KT8vLFxuICAgICAgbWF4TGVuZ3RoOiAxNSxcbiAgICAgIGN2dkxlbmd0aDogNCxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdqY2InLFxuICAgICAgZnVsbE5hbWU6ICdKQ0InLFxuICAgICAgcmU6IC9eKD86MzVcXGR7MCwyfSlcXGR7MCwxMn0vLFxuICAgICAgcGF0dGVybjogdGhpcy5zdGFuZGFyZFBhdHRlcm4sXG4gICAgICBtYXhMZW5ndGg6IDE2LFxuICAgICAgY3Z2TGVuZ3RoOiAzLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ2Rpc2NvdmVyJyxcbiAgICAgIGZ1bGxOYW1lOiAnRGlzY292ZXInLFxuICAgICAgcmU6IC9eKD86NjAxMXw2NVxcZHswLDJ9fDY0WzQtOV1cXGQ/KVxcZHswLDEyfS8sXG4gICAgICBwYXR0ZXJuOiB0aGlzLnN0YW5kYXJkUGF0dGVybixcbiAgICAgIG1heExlbmd0aDogMTYsXG4gICAgICBjdnZMZW5ndGg6IDMsXG4gICAgfSxcbiAgICB7XG4gICAgICBuYW1lOiAnZGluZXJzLWNsdWInLFxuICAgICAgZnVsbE5hbWU6ICdEaW5lcnMgQ2x1YicsXG4gICAgICByZTogL14zKD86MChbMC01XXw5KXxbNjg5XVxcZD8pXFxkezAsMTF9LyxcbiAgICAgIHBhdHRlcm46IHRoaXMuc3RhbmRhcmRQYXR0ZXJuLFxuICAgICAgbWF4TGVuZ3RoOiAxNCxcbiAgICAgIGN2dkxlbmd0aDogMyxcbiAgICB9LFxuICBdO1xuXG4gIEBJbnB1dCgpXG4gIGdldCBhZGRpdGlvbmFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FkZGl0aW9uYWxDYXJkcztcbiAgfVxuICBzZXQgYWRkaXRpb25hbENhcmRzKGNhcmRzOiBDcmVkaXRDYXJkW10pIHtcbiAgICB0aGlzLl9hZGRpdGlvbmFsQ2FyZHMgPSBjYXJkcztcbiAgICB0aGlzLmFkZENhcmRzKGNhcmRzKTtcbiAgfVxuICBwcml2YXRlIF9hZGRpdGlvbmFsQ2FyZHM6IENyZWRpdENhcmRbXTtcblxuICBASW5wdXQoKVxuICBnZXQgc2VwYXJhdG9yKCkge1xuICAgIHJldHVybiB0aGlzLl9zZXBhcmF0b3I7XG4gIH1cbiAgc2V0IHNlcGFyYXRvcihzZXBhcmF0b3I6IHN0cmluZykge1xuICAgIHRoaXMuX3NlcGFyYXRvciA9IHNlcGFyYXRvcjtcbiAgfVxuICBwcml2YXRlIF9zZXBhcmF0b3IgPSAnICc7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIEBIb3N0QmluZGluZygnYXR0ci5tYXhMZW5ndGgnKSBtYXhMZW5ndGg6IHN0cmluZztcblxuICBASG9zdExpc3RlbmVyKCdpbnB1dCcsIFsnJGV2ZW50J10pXG4gIG9uSW5wdXQoZXZlbnQ6IGFueSkge1xuICAgIHRoaXMuZm9ybWF0SW5wdXQoZXZlbnQpO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRJbnB1dChldmVudDogYW55KSB7XG4gICAgY29uc3QgaW5wdXQgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgY29uc3QgZm9ybWF0dGVkSW5wdXQgPSB0aGlzLmdldEZvcm1hdHRlZElucHV0KGlucHV0KTtcbiAgICBldmVudC50YXJnZXQudmFsdWUgPSBmb3JtYXR0ZWRJbnB1dDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Rm9ybWF0dGVkSW5wdXQodmFsdWU6IHN0cmluZykge1xuICAgIHZhbHVlID0gdGhpcy5yZW1vdmVOb25EaWdpdHModmFsdWUpO1xuICAgIGNvbnN0IGNhcmQgPSB0aGlzLmZpbmRDYXJkQnlOdW1iZXIodmFsdWUpO1xuXG4gICAgdGhpcy51cGRhdGVDdXJyZW50Q2FyZE5hbWVzKGNhcmQubmFtZSwgY2FyZC5mdWxsTmFtZSk7XG5cbiAgICBsZXQgY2FyZE51bU1heExlbmd0aDogbnVtYmVyO1xuXG4gICAgaWYgKHRoaXMuaGFzU3RhbmRhcmRQYXR0ZXJuKGNhcmQpKSB7XG4gICAgICBjb25zdCBtYXRjaGVzOiBSZWdFeHBNYXRjaEFycmF5IHwgbnVsbCA9IHZhbHVlLm1hdGNoKGNhcmQucGF0dGVybik7XG5cbiAgICAgIGlmIChtYXRjaGVzID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cblxuICAgICAgY2FyZE51bU1heExlbmd0aCA9IGNhcmQubWF4TGVuZ3RoICsgbWF0Y2hlcy5sZW5ndGggLSAxO1xuICAgICAgdGhpcy5tYXhMZW5ndGggPSBjYXJkTnVtTWF4TGVuZ3RoLnRvU3RyaW5nKCk7XG4gICAgICByZXR1cm4gbWF0Y2hlcy5qb2luKHRoaXMuc2VwYXJhdG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcmVzdWx0czogUmVnRXhwRXhlY0FycmF5IHwgbnVsbCA9IGNhcmQucGF0dGVybi5leGVjKHZhbHVlKTtcblxuICAgICAgaWYgKHJlc3VsdHMgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfVxuICAgICAgcmVzdWx0cy5zaGlmdCgpO1xuICAgICAgY2FyZE51bU1heExlbmd0aCA9IGNhcmQubWF4TGVuZ3RoICsgcmVzdWx0cy5sZW5ndGggLSAxO1xuICAgICAgdGhpcy5tYXhMZW5ndGggPSBjYXJkTnVtTWF4TGVuZ3RoLnRvU3RyaW5nKCk7XG4gICAgICByZXR1cm4gcmVzdWx0cy5maWx0ZXIodGhpcy5pc01hdGNoKS5qb2luKHRoaXMuc2VwYXJhdG9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZU5vbkRpZ2l0cyh2YWx1ZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHZhbHVlLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG4gIH1cblxuICBwcml2YXRlIGhhc1N0YW5kYXJkUGF0dGVybihjYXJkOiBDcmVkaXRDYXJkKSB7XG4gICAgcmV0dXJuIGNhcmQucGF0dGVybi50b1N0cmluZygpID09PSB0aGlzLnN0YW5kYXJkUGF0dGVybi50b1N0cmluZygpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc01hdGNoKG1hdGNoOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbWF0Y2ggIT09IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ3VycmVudENhcmROYW1lcyhuYW1lOiBzdHJpbmcsIGZ1bGxOYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLmNhcmROYW1lID0gbmFtZTtcbiAgICB0aGlzLmNhcmRGdWxsTmFtZSA9IGZ1bGxOYW1lO1xuICB9XG5cbiAgcHJpdmF0ZSBmaW5kQ2FyZEJ5TnVtYmVyKHZhbHVlOiBzdHJpbmcpIHtcbiAgICBjb25zdCBjYXJkVHlwZSA9IHRoaXMuY2FyZHMuZmluZChjYXJkID0+IHtcbiAgICAgIHJldHVybiBjYXJkLnJlLnRlc3QodmFsdWUpO1xuICAgIH0pO1xuXG4gICAgaWYgKCFjYXJkVHlwZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdENhcmQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNhcmRUeXBlO1xuICB9XG5cbiAgcHVibGljIGFkZENhcmRzKG5ld0NhcmRzOiBDcmVkaXRDYXJkW10pIHtcbiAgICBuZXdDYXJkcy5mb3JFYWNoKGNhcmQgPT4ge1xuICAgICAgdGhpcy5jYXJkcy5wdXNoKGNhcmQpO1xuICAgIH0pO1xuICB9XG59XG4iXX0=